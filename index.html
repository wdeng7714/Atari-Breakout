<!DOCTYPE html>
<html>
	<head>
		<meta charset = "utf-8"/>
		<title>Atari Breakout</title>
		<style>
			*{padding: 0; margin:0;}
			canvas{background: #eee; display: block; margin: 0 auto;}
		</style>
	</head>
	<body>
		<canvas id="myCanvas" width = "480" height = "320" style = "border:1px solid #000000;"> </canvas>
		<script>
			var canvas = document.getElementById("myCanvas");
			var ctx = canvas.getContext("2d");
			var x = canvas.width/2;
			var y = canvas.height-30;
			var dx = 2;
			var dy = -2;
			var ballRadius = 10;
			var r = 0;
			var b = 0;
			var g = 0;
			var paddleHeight = 10;
			var paddleWidth = 75;
			var paddleX = (canvas.width - paddleWidth)/2;
			var dp = 10;
			var rightPressed = false;
			var leftPressed = false;
			var brickRowCount = 3;
			var brickColumnCount = 5;
			var brickWidth = 75;
			var brickHeight = 20;
			var brickPadding = 10;
			var brickOffsetTop = 30;
			var brickOffsetLeft = 30;
			var bricks = [];
			for(c = 0; c < brickColumnCount; c++){
				bricks[c] = [];
				for(r = 0; r < brickRowCount; r++){
					bricks[c][r] = {x: 0, y: 0};
				}
			}	

			function rng(){
				return Math.floor(Math.random() *255) % 255;
			}
			function draw(){
				ctx.clearRect(0, 0, canvas.width, canvas.height);
				drawBall();
				drawBricks();
				drawPaddle();
				x += dx;
				y += dy;
				if(y + dy < ballRadius){
					dy = -dy;
					r = rng();
					g = rng();
					b = rng();
				} 
				else if(y + dy >= canvas.height - paddleHeight-ballRadius*2 && y + dy <= canvas.height - ballRadius*2 && x > paddleX && x < paddleX + paddleWidth){
					dy = -dy;
				}
				else if(y + dy > canvas.height - ballRadius){
					dx = 0;
					dy = 0;
						//document.location.reload();
				}
				else if(x + dx < ballRadius || x + dx > canvas.width-ballRadius){
					dx = -dx;
					r = rng();
					g = rng();
					b = rng();
				}
				if(rightPressed && paddleX <= canvas.width - paddleWidth - dp){
					paddleX += dp;
					
				}
				else if(leftPressed && paddleX >= dp){
					paddleX -= dp;
				}
			}

			function drawBall(){
				
				ctx.beginPath();
				ctx.arc(x, y, ballRadius, 0, Math.PI*2);
				ctx.fillStyle = "rgba(" + r.toString() + ", " + b.toString() + ", " + g.toString() + ", 1)";
				ctx.fill();
				ctx.closePath();
			}

			function drawPaddle(){
				ctx.beginPath();
				
				ctx.rect(paddleX, canvas.height-paddleHeight -ballRadius*2, paddleWidth, paddleHeight);
				ctx.fillStyle = "black";
				ctx.fill();
				ctx.closePath();
			}

			function drawBricks(){
				for(c = 0; c < brickColumnCount; c++){
					for(r = 0; r < brickRowCount; r++){
						bricks[c][r].x = c*(brickWidth + brickPadding) + brickOffsetLeft;
						bricks[c][r].y = r*(brickHeight + brickPadding) + brickOffsetTop;
						ctx.beginPath();
						ctx.rect(bricks[c][r].x, bricks[c][r].y, brickWidth, brickHeight);
						ctx.fillStyle = "#0095DD";
						ctx.fill();
						ctx.closePath();
					}
				}
			}
			document.addEventListener("keydown", keyDownHandler, false);
			document.addEventListener("keyup", keyUpHandler, false);

			function keyDownHandler(e){
				if(e.keyCode == 39){
					rightPressed = true;
					
				}
				else if(e.keyCode == 37){
					leftPressed = true;
				}

			}
			function keyUpHandler(e){
				if(e.keyCode == 39){
					rightPressed = false;
					//alert("up");
				}
				else if(e.keyCode == 37){
					leftPressed = false;
				}

			}
			setInterval(draw, 10);

		</script>
	</body>
</html>